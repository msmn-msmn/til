# ★アプリ開発記録備忘録
## 概要
開発記録を後で振り返るための困った事悩んだこと学んだことなどの覚書<br>
<br>
<br>

## README作成について
### 構想について
どんなアプリをつくるか考えるにあたって、どんなサービスが欲しいのかを今困っていることを書き出して<br>
グループ分けをすることで分析してみた。<br>
グループを大別するとメンタル系、スケジュール系、本系に分けることが出来た。<br>
メンタル系については解決法のイメージが湧かないから脇に置いておく。<br>
最初に本系グループについてのアプリを考えてみた。<br>
買った本の在庫管理と続巻の発売通知ができるサービス考えて同様のサービスを調査してみたら<br>
コミックログというそのものズバリみたいな既存サービスがあり、これを使えばいいかとなったので<br>
スケジュール系の構想へ方針変更した。<br>
<br>
スケジュール系についてを更に深堀することにしてみた。<br>
いざ掘り下げてみると本系よりも悩みが強い分、何をどうしたいのかという分解が比較的し易かった。<br>
<br>
### 類似のサービスについて
最初にサービスの参考にしたのがGithubのissueのボード機能。<br>
そしてスケジュール管理サービスのTrelloの機能。<br>
これらのサービスが作りたいとを持ったサービスの類似サービスになるかなと想定。<br>
<br>
<br>
<br>

## 画面遷移図について
正直にいって何から手を付けたらいいかわからなくてなかなか手が動かなかった。<br>
実装予定の機能とそれをどうやってページで繋いでいくかなんとなくイメージをしながら足していく。<br>
後から思ったのことだけどMVP機能を最初に作ってから継ぎ足して行けば良かったなと反省。<br>
<br>
<br>
### 画面遷移図のツールによる違い
画面遷移図を作る過程でFigmaの使用を経験した。<br>
いろんな機能があるのはいいんだけど無知からの初期導入だと使うのが時間がかかった。<br>
<br>
画面遷移図を最初はDrawioで制作していて後からFigmaの画面デザインを使用した画面遷移図も作ってみて<br>
感じたことは、プレゼンをする場合はFigmaを使った画面デザインを見ながら流れを追うことが出来る<br>
画面遷移図の方が説明しやすいということ。<br>
<br>
逆に、Drawioを使った画面遷移図はFigmaよりも短時間で作成できて共有することを意識しないなら<br>
Figmaよりも団時間で作成できることが利点だと感じた。<br>
<br>
<br>
<br>

## ER図の作成について
ER図の作成にはPlantUMLを使用した。<br>
理由は作図にはコードを書くだけでOKという簡便さとエンティティの配置を自動調整してくれるので<br>
テーブル構造の構想に集中できるからというのが大きい。<br>
<br>
以前使っていた時と環境が変わって、Java(JDK)とGraphvizを使ったローカル環境での作図ができなかったので<br>
Docker imageを使用した環境に左右されないローカルサーバー形式を採用した。<br>
利点としては環境に左右されずに使用できることとVScodeの拡張機能以外にパソコンに余計なファイルをインストールしなくても<br>
いいところが気に入った。<br>
<br>
これまでER図を作成する時にエンティティ同士のアソシエーションが表現できていれば良いと考えていたけど、<br>
外部キー制約によらないポリモーフィック関連によるアソシエーションも補足線として表現することを学んだ。<br>
ポリモーフィック関連の動きの図面に追加するとなかった時よりも断然動作が理解しやすくできた。<br>
<br>
<br>


## issueを使ったスケジュール管理
Githubのボード機能を使い開発工程を細かいissueに切り分けて開発を進めた。<br>
最初に必要な工程をピックアップするのに時間がかかったが計画が完成してからは次に何の実装をするかを<br>
迷わずに進めることが出来た。<br>
この必要な工程をピックアップする作業が技術的な負債の棚卸になり、内容を把握できる作業の見積もりはある程度の確度で<br>
行えるが、理解できていない実装については調べたうえで多めにバッファを取るという対応で処理した。<br>
また、期間内に終わらせるタスクが明確化するのでスケジュールの進捗が余裕があるのか、それとも遅れているのかの<br>
判断がやりやすかった。<br>
また、途中で思いついた重要度の低い修正内容などを下書きとして残して置けるので備忘録としても便利だと思った。<br>
<br>
<br>
<br>

## 実際にMVPまで開発をしてみて
最初に躓いたのがDockerの開発環境構築。<br>
compose.ymlやDockerfileの設定を手探りで行いながら、コンテナの起動完了までにかなり時間をかけることになった。<br>
つまり具合でいうとMVPまでに一番苦戦した所になると思う。<br>
コンテナ起動時の設定をサンプルコードを参考にしながらアレンジを加える事のハードルが想定よりも高かった。<br>
<br>
認証機能はDeviseを採用した。gem "sorcery" と比べるとサインインやログイン機能がすぐに用意できて予定よりも<br>
開発を進めることが出来た。<br>
<br>
デプロイ用のサーバーはデプロイの簡易性からrenderを採用した。<br>
開発していての反省点としては、機能の設計の練りが甘かったことと、機能を増やしすぎたこと。<br>
<br>
前者は機能の概要だけ決めて詳細を詰め切れていなかったこと。<br>
後者は実装予定の機能が本当に必要か検証の弁席が足りなかったこと。<br>
<br>
後々にどこまで拡張するかの視点ではなくつけたい機能を付けただけというのが実際のところ。<br>
どこまで拡張するかの視点で考えると、機能の必要不必要の判断をまず考えるところからはじめないとかな？<br>
<br>
開発していて難しかったのが、ローカル環境では動作するのに本番環境ではアプリが動作しないということ。<br>
原因の大半が環境変数の読み込みができていない or 環境変数の参照先が異なるというもので<br>
環境変数の取り扱いが難しいと思った。<br>
このつまずきから機密情報の保存方法には.envに環境変数を保存する方式とRails Credentialsで暗号化して保存する<br>
方式があることを学んだ。<br>
<br>
開発をするスケジュールがタイトになってしまったので、締め切りまでにMVPの作成を終わらせることが出来るか<br>
という焦りでコードが粗くなった部分もあり余裕を持ったスケジューリングの大切さも学ぶことが出来た。<br>
自分で作ったサービスを既存サービスと比べると普段何気なく接していたサービスってすごいんだなと実感した。<br>
<br>
<br>
<br>

## MVPからの開発をしてみて
## 独自ドメインの取得　＋　カスタムドメインメールの設定
登録や通知メールの送信が個人メールからになっていたのを、独自ドメインを取得してそれっぽいアドレスになるように修正中。<br>
個人使用のみならいらない設定だけどサービスを公開するにあたって避けるのは難しい項目だろうなと考えながら<br>
設定をしている。<br>
独自ドメインの設定をしていてドメインってこんなに簡単に取得できるものなのかと意外感があった。<br>
最初はサイト独自のアドレスからメールを送るのにドメインが必要なことも分かってなかった。<br>
そのドメインのDNS設定にSPF、DKIM、DMARCを追加して<br>
```
　・どこからのメールをドメインに送信許可するか
　・実際に送信したメールのなりすまし防止の署名証明
　・上2つの結果を受けて、受信側への取り扱い指示＋可視化
```
を設定していく。<br>
設定が出来ているかの確認は<br>
```
　・mxtoolbox.com
　・Google Admin Toolbox Check MX
```
を用いて確認を行った。<br>
<br>
メールの送信はサービスが小規模なので 2000通/1日 送信できるgoogle workspace を採用した。<br>
google workspace の設定をしていて思ったのはヘルプに出てくる内容と実際のページの名称が一致していなくて<br>
これどこのことを指しているんだ？ ということが結構あった。<br>
ヘルプの内容と似た記述の部分を調べながら設定して google workspace からのメールの送信元にエイリアスを設定することが出来た。<br>
最初に設定した時はデプロイ後にメース送信する度にアプリ画面に <br>
```
We're sorry, but something went wrong. If you are the application owner check the logs for more information.
```
と出て原因が分からなかったけど、ログを見るとSTMP設定認証用メールアドレスとアプリパスワードの設定がされていないのが<br>
原因だった。<br>
確かにGmailの時の設定そのままだったので成程と思いながら設定しなおすとメール送信が出来るようになった。<br>
<br>
サービスとしては重要なところではあるんだけど楽しさとか興味的には目に見えた変化が現れる系の機能の方が作っていて面白いと感じた。<br>
<br>
### マイルストーン機能の実装について<br>
タスクの進捗状況を分かりやすく管理できるようにしたいという目的で実装を考えたが、どうすればそれを達成できるのかという要件が漠然としているので<br>
まずは要件の洗い出しから始めた。要件を定義する時に実装機能を<br>
```
・使いたいタイミング
・実装機能を使って達成したいこと
・どういうことができたら嬉しいか
```
の観点から要件の大元を考えて草案を作ってから、AIと壁打ちしながら定義をした。<br>
草案を練ってからAIに不備や抜けを指摘してもらうと設計がしやすかった。<br>
目的意識があやふやにならないように、実装は段階ごとに細かく区切って行ってみた。<br>
その結果マイルストーン機能よりも先にテーブルのidをuuidに移行する実装を先にしないといけないことに気づいた。<br>
<br>
uuidの実装目的が表示URLからのID推測を避けるのが目的であるため修正を加えないといけないテーブルは<br>
既に作成していたTasks、Subtasks、Stepsになると考えられる。<br>
URLの表示を変えるだけなので既存テーブルにUUID用カラムの追加を行う。<br>
サービスを既にデプロイしているため既存データのバックフィル処理が必要になる。DBを後からいじるのがめんどいことを体感した。<br>

