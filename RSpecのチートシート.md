# ★RSpecのコード集
## ❇️テストのグループ化

## ***describe***
　describeブロックは、テスト対象のクラスやメソッドなどのグループを定義します。<br>
　テストコード内で複数のdescribeブロックを作成することができ、階層構造を持たせることもできます。<br>
　下記のようにコードを書きます。<br>
```
        describe "クラス名やメソッドの処理内容などを記載する" do
          ...
        end

```
　describeブロック内には、そのクラスやメソッドに関連する複数のテストケースを含めることができます。<br>

## ***context***
　contextブロックは、特定の状況や条件に基づいてテストをグループ化するために使用されます。<br>
　describeブロックの内部に記述されることが一般的です。<br>
　下記のようにコードを書きます。<br>
```
        describe "クラス名やメソッドの処理内容などを記載する" do
          context "状況や条件などを記載する" do
            ...
          end
        end
```
　contextブロックを使うことで、テストの可読性が向上し、どのような状況や条件でテストを行っているのかが明確になります。<br>

## ***it***
　itブロックは、特定のテストケースを定義し、1つのitブロックは1つのテストケースを表します。<br>
　下記のようにコードを書きます。<br>
 ```
        describe "クラス名やメソッドの処理内容などを記載する" do
          context "状況や条件などを記載する" do
            it "テストケースの説明" do
              ...
            end
          end
        end
```
　itブロック内には、テストの実行や結果の検証が記述されます。<br>

## ❇️検証メソッド
　値を検証するためのexpectメソッドは基本的な構文は下記のようになります。<br>
```
        expect(テスト対象の値).to マッチャー(期待する値)
```

## ❇️マッチャー
　RSpecのマッチャーは、テストコード内で期待される値と実際の値を比較し、テスト結果を判定するために使用されます。<br>


## ***eq***
　eqマッチャーは、2つの値が等しいかどうかを比較します。<br>
```
        expect(テスト対象の値).to eq(期待する値)
```
　modelに記載した処理による実際の値と期待する値を比較して、等しい場合にテストが成功します。<br>

## ***be***
　beマッチャーは、真偽値のtrue/falseやオブジェクトが特定の条件を満たすかどうかを判定します。<br>
```
        expect(テスト対象の値).to be true # be true : 値がtrueであるかどうかをチェックします
        expect(テスト対象の値).to be false # be false : 値がfalseであるかどうかをチェックします
        expect(テスト対象の値).to be_nil # be_nil : 値がnilであるかどうかをチェックします
```

## ***be_empty***
　be_emptyマッチャーは、配列や文字列、ハッシュなどが空であるかどうかを検証します。<br>
```
        expect(テスト対象の配列).to be_empty
        expect(テスト対象の文字列).to be_empty
        expect(テスト対象のハッシュ).to be_empty
```
　配列が空の場合や、文字列が空の場合、ハッシュが空の場合にテストが成功します。<br>
　要素や文字列、キーと値のペアが存在しない状態を表します。<br>

## ***be_valid***
　be_validマッチャーは、オブジェクトがバリデーションに通るかどうかを検証します。<br>
　主にActive Recordモデルのテストで使用されます。<br>
```
        expect(テスト対象のオブジェクト).to be_valid
```
　オブジェクトがバリデーションに通ってる場合にテストが成功します。<br>

　be_emptyと組み合わせて、エラーメッセージの格納する配列が空であることも追加でテストとして記載するとより正確なテストを書くことができます。<br>
```
        expect(テスト対象のオブジェクト).to be_valid
        expect(テスト対象のオブジェクトのエラーの配列).to be_empty
```

## ***be_invalid***
　be_invalidマッチャーは、be_validの逆でオブジェクトがバリデーションに通らない状態であることを検証するために使用されます。<br>
```
        expect(object).to be_invalid
```
　objectがバリデーションに合格しない場合にテストが成功します。<br>
　オブジェクトの属性値が必要なバリデーションルールを満たしていないので、エラーが発生している状態です。<br>
<br>
<br>
## ***Capybaraでよく使われるマッチャー（マッチングメソッド）の一覧***
| マッチャー                           | 説明                                    |
| ------------------------------- | ------------------------------------- |
| `have_content('text')`          | ページに指定したテキストが含まれているかを検証               |
| `have_selector('css')`          | 指定したCSSセレクタの要素が存在するかを検証               |
| `have_field('name')`            | 指定したフォームのフィールドが存在するかを検証               |
| `have_button('name')`           | 指定したボタンが存在するかを検証                      |
| `have_link('text')`             | 指定したテキストのリンクが存在するかを検証                 |
| `have_checked_field('name')`    | チェックボックスまたはラジオボタンがチェックされているかを検証       |
| `have_unchecked_field('name')`  | チェックボックスまたはラジオボタンが未チェックであるかを検証        |
| `have_select('name', options:)` | セレクトボックスに指定したオプションが存在するかを検証           |
| `have_table('id')`              | 指定したIDを持つテーブルが存在するかを検証（またはHTML内のテーブル） |
| `have_text('text')`             | `have_content`の別名                     |
| `have_current_path(path)`       | 現在のURLパスが一致するかを検証                     |
| `have_no_content('text')`       | 指定したテキストが存在しないことを検証                   |
| `have_css('selector')`          | 指定CSSが存在するか（`have_selector`とほぼ同じ）     |
<br>
<br>

## ***🔗 アクセス・ページ遷移関連***
| メソッド                         | 説明                  |
| ---------------------------- | ------------------- |
| `visit '/path'`              | 指定したパスにアクセス         |
| `have_current_path('/path')` | 現在のURLパスが一致しているかを検証 |
<br>
<br>

## ***🧭 リンク・ボタン操作***
| メソッド                                  | 説明                                           |
| ------------------------------------- | -------------------------------------------- |
| `click_link('リンク名')`                  | 指定したリンクをクリック                                 |
| `click_button('ボタン名')`                | 指定したボタンをクリック                                 |
| `click_on('リンクまたはボタン名')`              | リンクまたはボタンをクリック（`click_link_or_button`のエイリアス） |
| `have_link('リンク名')`                   | 指定したリンクが存在するかを検証                             |
| `have_button('ボタン名')`                 | 指定したボタンが存在するかを検証                             |
| `accept_confirm { click_link '削除' }`  | 確認ダイアログを「OK」で受け入れてリンクをクリック                   |
| `dismiss_confirm { click_link '削除' }` | 確認ダイアログを「キャンセル」で拒否してリンクをクリック                 |
<br>
<br>

## ***📝 フォーム操作・入力***
| メソッド                              | 説明                   |
| --------------------------------- | -------------------- |
| `fill_in 'フィールド名', with: '値'`     | 指定したフィールドに値を入力       |
| `choose 'ラジオボタン名'`                | 指定したラジオボタンを選択        |
| `check 'チェックボックス名'`               | 指定したチェックボックスをチェック    |
| `uncheck 'チェックボックス名'`             | 指定したチェックボックスのチェックを外す |
| `select '選択肢', from: 'セレクトボックス名'` | セレクトボックスで指定した選択肢を選択  |
| `attach_file 'フィールド名', 'ファイルパス'`  | ファイルをアップロード          |
<br>
<br>

## ***🔍 ページ内の検証・検索***
| マッチャー                            | 説明                        |
| -------------------------------- | ------------------------- |
| `have_content('テキスト')`           | 指定したテキストがページに含まれているかを検証   |
| `have_text('テキスト')`              | 上記と同じ（エイリアス）              |
| `have_selector('CSSセレクタ')`       | 指定したCSSセレクタの要素が存在するかを検証   |
| `have_css('CSSセレクタ')`            | 上記と同じ（エイリアス）              |
| `have_field('フィールド名')`           | 指定したフォームフィールドが存在するかを検証    |
| `have_checked_field('フィールド名')`   | チェック済みのフィールドが存在するかを検証     |
| `have_unchecked_field('フィールド名')` | 未チェックのフィールドが存在するかを検証      |
| `have_select('セレクトボックス名')`       | 指定したセレクトボックスが存在するかを検証     |
| `have_table('テーブルID')`           | 指定したIDを持つテーブルが存在するかを検証    |
| `have_xpath('XPath式')`           | 指定したXPathに一致する要素が存在するかを検証 |
<br>
<br>

## ***🔍 ページ内の否定検証***
| マッチャー                               | 説明                         |
| ----------------------------------- | -------------------------- |
| `have_no_content('テキスト')`           | 指定したテキストがページに含まれていないかを検証   |
| `have_no_selector('CSSセレクタ')`       | 指定したCSSセレクタの要素が存在しないかを検証   |
| `have_no_field('フィールド名')`           | 指定したフォームフィールドが存在しないかを検証    |
| `have_no_checked_field('フィールド名')`   | チェック済みのフィールドが存在しないかを検証     |
| `have_no_unchecked_field('フィールド名')` | 未チェックのフィールドが存在しないかを検証      |
| `have_no_select('セレクトボックス名')`       | 指定したセレクトボックスが存在しないかを検証     |
| `have_no_table('テーブルID')`           | 指定したIDを持つテーブルが存在しないかを検証    |
| `have_no_xpath('XPath式')`           | 指定したXPathに一致する要素が存在しないかを検証 |
<br>
<br>

## ***📦 スコープ操作（特定の要素内で）***
| メソッド                                 | 説明                     |
| ------------------------------------ | ---------------------- |
| `within('#スコープID') do ... end`       | 指定したIDの要素内で操作や検証を行う    |
| `within_fieldset('ラベル名') do ... end` | 指定したフィールドセット内で操作や検証を行う |
| `within_table('テーブルID') do ... end`  | 指定したIDのテーブル内で操作や検証を行う  |
<br>
<br>

